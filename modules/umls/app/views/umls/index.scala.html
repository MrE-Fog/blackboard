@import blackboard.umls.UMLSKSource
@(ks: UMLSKSource)

@views.html.core.main("UMLS module"){
<div class="container-fluid" style="margin-top:10px;">
  <div class="jumbotron">
    <h1 class="display-4">UMLS</h1>
    <p class="lead">This is <a href="#" data-toggle="modal"
                               data-target="#umls-sources-modal">UMLS</a>
      module. The JDBC url is <code>@ks.getDatabase.getUrl</code>.
  </div>
  <div class="row">  
    <div class="col-md-6">
      <div class="row">
        <div class="col">
          <div class="input-group">
            <span class="input-group-btn">  
              <button id="search-clear"
                      class="btn btn-default" type="button">Clear</button>
            </span>
            <input id="search-input" type="text" class="form-control"
                   placeholder="Search for concepts...">
            <span class="input-group-btn">
              <button id="search-concept"
                      class="btn btn-default" type="button">Search</button>
            </span>
          </div><!-- /input-group -->
        </div>
      </div>
    </div>
  </div> <!-- row -->
  <div class="row">
    <div class="col">
      <pre id="search-output" class="pre-scrollable"
           style="overflow-y:auto;"></pre>
    </div>
  </div>
</div>

<div class="modal fade" id="umls-sources-modal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">UMLS Sources</h5>        
        <button type="button" class="close" data-dismiss="modal"
                aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="col">
          <pre id="umls-sources" class="pre-scrollable"></pre>
        </div>
      </div>
    </div>
  </div>
</div>

}(HtmlFormat.empty){
    function search () {
        var term = $('#search-input').val();
        console.log('searching for "'+term+'"');
        $.ajax({
            url: '@controllers.umls.routes.Controller.findConcepts("")'+term,
            dataType: 'text',
            success: function (d) {
                console.log(d);
                $('#search-output').html(d);
            }
        });
    }
    
    $(document).ready(function () {
        $('#search-concept').on('click', function () {
            search ();
        });
        
        $('#search-clear').on('click', function () {
            $('#search-input').val('');
        });
        
        $('#search-input').keypress(function (ev) {
            var keycode = (ev.keyCode ? ev.keyCode : ev.which);
            if (keycode == '13') { // enter pressed
                search ();
            }
        });

        $.ajax({
            url: '@controllers.umls.routes.Controller.datasources',
            dataType: 'text',
            success: function (d) {
                $('#umls-sources').html(d);
            }
        });
    });
}
